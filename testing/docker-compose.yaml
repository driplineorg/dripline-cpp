version: '3'

services:
  # a rabbit broker
  rabbit_broker:
    image: rabbitmq:3-management
    ports:
      - "5672:5672"
      - "15672:15672"

  simple:
    #image: driplineorg/dripline-cpp:main-dev
    image: driplineorg/dripline-cpp:int-test
    command: /usr/local/bin/run_simple_service -vv -b rabbit_broker --auth-file /root/authentication.json
    volumes:
      - type: bind
        source: ./authentication.json
        target: /root/authentication.json

  tests:
    #image: driplineorg/dripline-cpp:main-dev
    image: driplineorg/dripline-cpp:int-test
    environment:
      TERM: xterm
    command: /root/int_test_get.sh
    volumes:
      - type: bind
        source: ./authentication.json
        target: /root/authentication.json
      - type: bind
        source: ./int_test_get.sh
        target: /root/int_test_get.sh
      - type: bind
        source: ./bash_test_tools/bash_test_tools
        target: /root/bash_test_tools
