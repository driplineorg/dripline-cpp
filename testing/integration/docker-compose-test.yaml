version: '3'

services:
  test:
    image: ghcr.io/driplineorg/dripline-cpp:${IMG_TAG:-latest-testing}
    depends_on:
      - rabbit-broker
      - simple-service
    volumes:
      - ./wait-for-broker.sh:/root/wait-for-broker.sh
      - ./run-tests.sh:/root/run-tests.sh
    command: >
      bash -c "/root/wait-for-broker.sh &&
              sleep 1 &&
              /root/run-tests.sh"
    configs:
      - auths.json
#    networks:
#      - dl-test
